<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · StochasticSeriesExpansion.jl</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">StochasticSeriesExpansion.jl</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">StochasticSeriesExpansion.jl</a></li><li><span class="tocitem">Usage</span><ul><li class="is-active"><a class="tocitem" href="tutorial.html">Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Writing-a-job-script"><span>Writing a job script</span></a></li><li><a class="tocitem" href="#Running-the-simulation"><span>Running the simulation</span></a></li><li><a class="tocitem" href="#Evaluating-the-results"><span>Evaluating the results</span></a></li></ul></li><li><a class="tocitem" href="models.html">Predefined models</a></li></ul></li><li><span class="tocitem">Implementing custom models</span><ul><li><a class="tocitem" href="interfaces.html">Interfaces</a></li><li><a class="tocitem" href="sse_data.html">Simulation data structure</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Usage</a></li><li class="is-active"><a href="tutorial.html">Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="tutorial.html">Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/lukas-weber/StochasticSeriesExpansion.jl/blob/main/docs/src/tutorial.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><p>In this tutorial, we will calculate the magnetic susceptibility of the spin-1 honeycomb antiferromagnet BaNi₂V₂O₈, reproducing a calculation in <a href="https://doi.org/10.1103/physrevb.104.064402">PRB <strong>104</strong>, 065502 (2021)</a>, where an anisotropic Heisenberg model,</p><p class="math-container">\[    H = J \sum_{⟨i,j⟩} \mathbf{S}_i \cdot \mathbf{S}_j + D^z \sum_i (S^z_i)^2\]</p><p>was fit to neutron-scattering data. Above, the first sum counts all nearest neighbor bonds (and we neglect next-nearest and next-next-nearest neighbor interactions). However, we do take into account the easy-plane anisotropy <span>$D^z$</span> to model the split between in-plane and out of plane magnetic susceptibility.</p><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>As a first step, we need to install StochasticSeriesExpansion.jl and <a href="https://lukas-weber.github.io/Carlo.jl/stable/">Carlo.jl</a>, which can be done from the Julia REPL.</p><pre><code class="nohighlight hljs">julia&gt;]
pkg&gt; add Carlo
pkg&gt; add StochasticSeriesExpansion</code></pre><h2 id="Writing-a-job-script"><a class="docs-heading-anchor" href="#Writing-a-job-script">Writing a job script</a><a id="Writing-a-job-script-1"></a><a class="docs-heading-anchor-permalink" href="#Writing-a-job-script" title="Permalink"></a></h2><p>To specify the parameters we want to simulate, we want to write a job script. The following sets up the predefined <a href="models.html#StochasticSeriesExpansion.MagnetModel"><code>MagnetModel</code></a> for our Hamiltonian on a honeycomb lattice and defines tasks for a range of system sizes and temperatures to simulate.</p><pre><code class="language-julia hljs"># bani2v2o8.jl

using Carlo
using Carlo.JobTools
using StochasticSeriesExpansion

tm = TaskMaker()
tm.sweeps = 80000
tm.thermalization = 10000
tm.binsize = 100

temperatures = range(0.05, 4, 20)
system_sizes = [10, 20]

tm.model = MagnetModel
tm.S = 1
tm.J = 1
tm.Dz = 0.005645 # D^{QMC}_{EP(XY)}/J^{QMC}_n from PRB 104, 065502 

tm.measure = [:magnetization]
for L in system_sizes
    tm.lattice = (unitcell = UnitCells.honeycomb, size = (L, L))

    for T in temperatures
        tm.T = T
        task(tm)
    end
end

job = JobInfo(
    splitext(@__FILE__)[1],
    StochasticSeriesExpansion.MC;
    run_time = &quot;24:00:00&quot;,
    checkpoint_time = &quot;30:00&quot;,
    tasks = make_tasks(tm),
)

start(job, ARGS)
</code></pre><p>The content of <code>tm.measure</code> is interpreted by the <a href="models.html#StochasticSeriesExpansion.MagnetModel"><code>MagnetModel</code></a> in order to decide what kinds of observables should be measured. <code>:magnetization</code> is a shortcut for observables related to the magnetization in <span>$S^z$</span> direction, including the susceptibility.</p><p>Apart from the model parameters, we also set some general Monte Carlo simulation parameters that are read by Carlo.jl. This includes the number of <code>sweeps</code> (Monte Carlo timesteps), the number of <code>thermalization</code> steps and the internal <code>binsize</code> that is averaged before saving data to disk (use it to save disk space, but keep it small compared to <code>sweeps</code>).</p><p>The <code>task</code> function takes a snapshot of the current properties of the <a href="https://lukas-weber.github.io/Carlo.jl/stable/jobtools.html#Carlo.JobTools.TaskMaker"><code>TaskMaker</code></a> and turns it into one parameter set to be simulated.</p><p>In the <a href="https://lukas-weber.github.io/Carlo.jl/stable/jobtools.html#Carlo.JobTools.JobInfo"><code>JobInfo</code></a> structure we specify</p><ul><li>the job directory (<code>splitext(@__FILE__)[1]</code> just evaluates to the location where the job script is saved)</li><li>that we want to run a simulation with StochasticSeriesExpansion.jl</li><li>the maximum runtime before the simulation stops</li><li>the interval between checkpoints</li><li>the parameter sets (tasks) that should be simulated, created using <code>TaskMaker</code></li></ul><h2 id="Running-the-simulation"><a class="docs-heading-anchor" href="#Running-the-simulation">Running the simulation</a><a id="Running-the-simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Running-the-simulation" title="Permalink"></a></h2><p>Next we should run it using</p><pre><code class="language-bash hljs">mpirun -n $NCORES julia bani2v2o8.jl run</code></pre><p>While you wait, you can run <code>julia bani2v2o8.jl --help</code> for an explanation of the Carlo command line interface.</p><p>In general, the computational cost is linear in the number of spins and the inverse temperature. For the system defined here it is small enough to run on a powerful laptop. For larger systems, running on a high-performance computing cluster may be necessary.</p><p>Once the simulation is done, we will find a new directory <code>bani2v2o8.data</code> and a file <code>bani2v2o8.results.json</code>. The former contains the raw data that was recorded during the simulation and checkpoints, the latter has the postprocessed averages and errorbars of the observables.</p><div class="admonition is-info"><header class="admonition-header">Checkpointing</header><div class="admonition-body"><p>Carlo.jl automatically creates checkpoints for simulations. This means if it is aborted, it will restart from where it left off. For a finished simulation it is also possible to increase the <code>sweeps</code> and continue it to gather more statistics.</p><p>This means that to restart a simulation from scratch, it is necessary to first delete the job data,</p><pre><code class="language-bash hljs">julia $JOBSCRIPT delete</code></pre><p>or to run with the restart flag</p><pre><code class="language-bash hljs">julia $JOBSCRIPT run --restart</code></pre></div></div><h2 id="Evaluating-the-results"><a class="docs-heading-anchor" href="#Evaluating-the-results">Evaluating the results</a><a id="Evaluating-the-results-1"></a><a class="docs-heading-anchor-permalink" href="#Evaluating-the-results" title="Permalink"></a></h2><p>The <code>Carlo.ResultTools</code> submodule has a tool to directly import the postprocessed data into a Julia dataframe. The following snippet is an example of that.</p><pre><code class="language- hljs">using Plots
using DataFrames
using LaTeXStrings
using Carlo.ResultTools

df = DataFrame(ResultTools.dataframe(&quot;bani2v2o8.results.json&quot;))

df.L = [lattice[&quot;size&quot;][1] for lattice in df.lattice]

plot(df.T, df.MagChi, group=df.L,
    xlabel = L&quot;Temperature $T/J$&quot;,
    ylabel = L&quot;Magnetic susceptibility $χ^z J$&quot;,
    legend_title = &quot;L&quot;
)</code></pre><p>The dataframe contains all parameters from the job file as well as the observables that were measured. <code>MagChi</code> is the uniform magnetic susceptibility in <span>$S^z$</span> direction, perpendicular to the easy-plane anisotropy created by <span>$D_z$</span>. As we can see, the basic shape of the susceptibility (Fig. 3(b) in the paper) is reproduced, but it is not converged to the thermodynamic limit at <span>$L=10$</span>. We should therefore run larger system sizes until we can assure convergence (the data in the paper is at <span>$L=42$</span>).</p><p>A useful heuristic to understand the system size convergence is the concept of the finite size gap, i.e. the gap that opens in a gapless model due to finite boundary conditions. In a Heisenberg-like antiferromagnet like ours, it is typically on the order of <span>$J/L$</span> (more generally it is related to the dispersion relation of the gapless excitations). Therefore, to the resolve the effect of <span>$D_z$</span>, we should choose a system size so that <span>$J/L \ll D_z$</span>. We can use a similar logic to probe ground state properties using our finite temperature method: As long as the <span>$T$</span> is smaller than the finite-size gap, we cannot resolve its finiteness. Therefore, a popular way to reach the ground state in the thermodynamic limit is to scale <span>$T\propto J/2L$</span> while scaling up <span>$L$</span>.</p><p>To get the in-plane susceptibility <span>$\chi^{x/y}$</span>, we can simply rotate the anisotropy into the <span>$x$</span> direction (using the <code>Dx</code> parameter) and run a simulation measuring <span>$\chi^z$</span> again.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="index.html">« StochasticSeriesExpansion.jl</a><a class="docs-footer-nextpage" href="models.html">Predefined models »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 25 October 2024 16:36">Friday 25 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
